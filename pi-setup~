#!/bin/sh

$PI_NUMBER=0

#===============================
#==========Pi Number============
#===============================
echo "\nWelcome to the CERF Pi setup script"
echo "What number Pi is this?"
echo "This number will be used for the identification of the Pi and its data."
echo "Example: 2 (Please only enter a number)\n"
echo -n "Pi Number >"
read PI_NUMBER
echo "\nYou entered: $PI_NUMBER"
read -p "Would you like to continue?(y/n): " REPLY
if [ "$REPLY" != "y" ]; then
	exit
fi
echo

export PI_NUMBER

echo $PI_NUMBER > /home/cjk36/Desktop/CERF-DAQ/WebPage/pages/piNumber.txt

echo "Proceeding...\n"
#===============================
#=====CHANGING HOSTNAME=========
#===============================
echo "Changing Hostname..."
#echo "cerfpi$PI_NUMBER" > /etc/hostname 
#===============================
#=====PASSWORD SETTING==========
#===============================
echo "We will now update the Pi password."
echo "The default passord is 'raspberry'"
echo "Please record the new password, it will be used for SSH\n"
read -p "Would you like to change the user password?(y/n): " PASSCHANGE
if [ "$PASSCHANGE" = "y" ]; then
	passwd pi
fi
echo "proceeding"

#===============================
#=====Creating Directories======
#===============================
echo "Creating directories"
RawDir='Pi_'$PI_NUMBER'_Raw'
SummaryDir='Pi_'$PI_NUMBER'_Summary'
if [ -d "/home/pi/Desktop/Data" ]; then
	sudo rm -r /home/pi/Desktop/Data
fi
mkdir "/home/pi/Desktop/Data"
mkdir "/home/pi/Desktop/Data/$RawDir"
mkdir "/home/pi/Desktop/Data/$SummaryDir"
echo "	+Done"
#===============================
#===Getting necessary stuff=====
#===============================
#echo "Installing packages"
#sudo apt-get update
#sudo apt-get install zip
#sudo apt-get install apache2 -y
#sudo apt-get install php5 libapache2-mod-php5 -y
#sudo apt-get install i2c-tools
#sudo apt-get install python-pip
#sudo apt-get install xrdp
#sudo easy_install pytz
#sudo easy_install smbus 
#sudo adduser pi i2c 
#==============================
#====Creating Global Vars =====
#==============================

echo "Creating enviroment Vars"

if grep "CERF-DAQ/Scripts" /etc/profile
then
	echo "Bash file set up correctly" 
else
	echo "PATH=""$""PATH:/home/pi/Desktop/CERF-DAQ/Scripts" >> /etc/profile
	echo "PATH=""$""PATH:/home/pi/Desktop/CERF-DAQ/Python" >> /etc/profile
	echo "export PATH" >> /etc/profile
fi

chmod u+x /home/pi/Desktop/CERF-DAQ/initialize-global-vars

echo "Initializing the global variables"


if [ -f "/home/pi/Desktop/CERF-DAQ/Python/user_input.py" ]; then 
	sudo rm /home/pi/Desktop/CERF-DAQ/Python/user_input.py
fi

./Desktop/CERF-DAQ/initialize-global-vars

#===============================
#=====Editing Sensor Names =====
#===============================

sudo nano /home/pi/Desktop/CERF-DAQ/Python/user_input.py
sudo python /home/pi/Desktop/CERF-DAQ/Python/global_vars_to_php.py

#===============================
#==moving git web to webserver =
#===============================
echo "Creating the Web Server"
sudo rm -r /var/www
sudo mkdir "/var/www"
sudo ln -s /home/pi/Desktop/CERF-DAQ/WebPage/* /var/www
#==============================
#====Creating Cron Jobs =======
#==============================
echo "Creating Cron Jobs"
echo "#m h dom mon dow  command" > mycron
echo "* * * * * /home/pi/Desktop/CERF-DAQ/Python/runpython.sh >> /dev/cronlog.log 2>&1" >> mycron
echo "00 01 * * * /home/pi/Desktop/CERF-DAQ/Python/runAnalysis.sh >> /dev/cronlog.log 2>&1" >> mycron
echo "00 00 * * * /home/pi/Desktop/CERF-DAQ/Scripts/zip_raw.sh >> /dev/cronlogzip.log 2>&1" >> mycron
echo "00 02 * * 6 /home/pi/Desktop/CERF-DAQ/Scripts/update-pi >> /dev/cronlogzip.log 2>&1" >> mycron
sudo crontab mycron 
sudo rm mycron
sudo /etc/init.d/cron restart
echo "Setup is completed" 
echo "The pi will now reboot and start taking data"
echo "You will be disconected"
sudo #reboot 


